<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .collapsible {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
        }

        /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
        .active, .collapsible:hover {
        background-color: #ccc;
        }

        /* Style the collapsible content. Note: hidden by default */
        .content {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            color: white;
            background-color: transparent;
        }
        body {
            background-image: url("spyvsspy.jpg");
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
    </style>
    <title>Super Secret Agent Stuff</title>
</head>
<body bgcolor="black">
    <button type="button" class="collapsible">Create Reimbursement Request</button>
    <div class="content">
        Select the reason for reimbursement:
        <select id="reason">
            <option value="1">Travel</option>
            <option value="2">Ammunition</option>
            <option value="3">Food</option>
            <option value="4">Vetrenarian</option>
            <option value="5">Equipment</option>
        </select>
        <br>
        Enter comment describing the reason:
        <input id="reimbursement_request_comment" size="100">
        <br>
        Enter amount:
        <input type="number" id="amount">
        <br>
        <button id="create_request" onclick="createRequest()">Create Request</button>
    </div>
    <button type="button" class="collapsible">View My Total Amount Requested</button>
    <div class="content">
        <button id="viewTotal" onclick="viewTotalById()">View Total Amount</button>
    </div> 
    <button type="button" class="collapsible">Cancel Reimbursement Request</button>
    <div class="content">
        Please enter the reimbursement request id number:
        <input type="number" id="reimbursement_request_id">
        <br>
        <button id="cancelRequest" onclick="cancelRequestById()">Cancel Request</button>
    </div> 
    <button type="button" class="collapsible">Log Out</button>
    <div class="content">
        <button id="logOut" onclick="doLogout()">Log Out</button>
    </div>
</body>
<script>
    //for testing creating token to observe edits on page
    //window.localStorage.setItem("token", "somethingsomething2");
        const employeeId = window.sessionStorage.getItem("token").slice(-1)
        const tableName =  "reimbursement_requests";
        const apiURL = "http://localhost:5000/";

        function doLogout() {
            window.sessionStorage.removeItem("token");
            alert("You have been sucessfully logged out!");
            window.location.href="login.html";
        }

        async function createRequest() {
            const reasonId = document.getElementById("reason").value;
            const reimbursementRequestComment = document.getElementById("reimbursement_request_comment").value;
            const amount = document.getElementById("amount").value;
            reimbursmentRequestJSON = {
                'token': window.localStorage.getItem("token"),
                'tableName': tableName,
                'employeeId': employeeId,
                'reasonId': reasonId,
                'reimbursementRequestComment': reimbursementRequestComment,
                'amount': amount
            }
            let sendRequest = {
                method:"POST",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(reimbursmentRequestJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.message);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        async function viewTotalById() {
            viewTotalByIdJSON = {
                'token': window.localStorage.getItem("token"),
                'tableName': tableName,
                'employeeId': employeeId,
            }
            let sendRequest = {
                method:"PATCH",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(viewTotalByIdJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.message);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        async function cancelRequestById() {
            cancelRequestByIdJSON = {
                'token': window.localStorage.getItem("token"),
                'tableName': tableName,
                'employeeId': employeeId,
            }
            let sendRequest = {
                method:"PATCH",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(cancelRequestByIdJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.message);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        let coll = document.getElementsByClassName("collapsible");
        let i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                let content = this.nextElementSibling;
                if (content.style.display === "block") {
                content.style.display = "none";
                } else {
                content.style.display = "block";
                }
            });
        } 
    
</script>
</html>