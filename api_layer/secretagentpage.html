<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .collapsible {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 50%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            margin-left: 5%;
            margin-right: 5%;
            margin-top: 2%;
            margin-bottom: 2%;
        }

        /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
        .active, .collapsible:hover {
        background-color: #ccc;
        }

        /* Style the collapsible content. Note: hidden by default */
        .content {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            color: black;
            background-color: rgb(155, 127, 127, .75);
            width: 75%;
            margin-left: 10%;
        }
        body {
            background-image: url("spyvsspy.jpg");
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        table {
            margin-left: 15%;
        }
    </style>
    <title>Super Secret Agent Stuff</title>
</head>
<body bgcolor="black">
    <button type="button" class="collapsible">Create Reimbursement Request</button>
    <div class="content">
        <table>
            <tr>
                <td><h3>Select the reason for reimbursement:</h3></td>
                <td><select id="reason">
                        <option value="1">Travel</option>
                        <option value="2">Ammunition</option>
                        <option value="3">Food</option>
                        <option value="4">Vetrenarian</option>
                        <option value="5">Equipment</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><h3>Enter comment describing the reason:</h3></td>
                <td><input id="reimbursement_request_comment" size="100"></td>
            </tr>  
            <tr>
                <td><h3>Enter amount:</h3></td>
                <td><input type="number" id="amount"></td>
            </tr>
            <tr>
                <td><button id="create_request" onclick="createRequest()">Create Request</button></td>
            </tr>
        </table>
    </div>
    <button type="button" class="collapsible">View My Total Amount Requested</button>
    <div class="content">
        <table>
            <tr>
                <td><button id="viewTotal" onclick="viewTotalById()">View Total Amount</button></td>
            </tr>
        </table>
    </div> 
    <button type="button" class="collapsible">Cancel Reimbursement Request</button>
    <div class="content">
        <table>
            <tr>
                <td><h3>Please enter the reimbursement request id number:</h3></td>
                <td><input type="number" id="reimbursement_request_id"></td>
            </tr>
            <tr>
                <td><button id="cancelRequest" onclick="cancelRequestById()">Cancel Request</button></td>
            </tr>
        </table>
    </div> 
    <button type="button" class="collapsible">Log Out</button>
    <div class="content">
        <table>
            <tr>
                <td><button id="logOut" onclick="doLogout()">Log Out</button></td>
            </tr>
        </table>
    </div>
</body>
<script>
    //for testing creating token to observe edits on page
    window.sessionStorage.setItem("token", "somethingsomething2");
        if(!window.sessionStorage.getItem("token")) {
            alert("You do not have access to this page!")
            window.location.href="login.html"
        }

        const employeeId = window.sessionStorage.getItem("token").slice(-1)
        const tableName =  "reimbursement_requests";
        const apiURL = "http://localhost:5000/";

        function doLogout() {
            window.sessionStorage.removeItem("token");
            alert("You have been sucessfully logged out!");
            window.location.href="login.html";
        }

        async function createRequest() {
            const reasonId = document.getElementById("reason").value;
            const reimbursementRequestComment = document.getElementById("reimbursement_request_comment").value;
            const amount = document.getElementById("amount").value;
            reimbursmentRequestJSON = {
                'token': window.sessionStorage.getItem("token"),
                'tableName': tableName,
                'employeeId': employeeId,
                'reasonId': reasonId,
                'reimbursementRequestComment': reimbursementRequestComment,
                'amount': amount
            }
            alert(window.sessionStorage.getItem("token"));
            let sendRequest = {
                method:"POST",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(reimbursmentRequestJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.reasonId);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        async function viewTotalById() {
            viewTotalByIdJSON = {
                'token': window.sessionStorage.getItem("token"),
                'tableName': tableName,
                'employeeId': employeeId,
            }
            let sendRequest = {
                method:"PATCH",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(viewTotalByIdJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.message);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        async function cancelRequestById() {
            const reimbursement_request_id = document.getElementById("reimbursement_request_id").value;
            cancelRequestByIdJSON = {
                'token': window.sessionStorage.getItem("token"),
                'tableName': tableName,
                'reimbursement_request_id': reimbursement_request_id
            }
            let sendRequest = {
                method:"DELETE",
                headers:{'Content-Type':"application/json"},
                body: JSON.stringify(cancelRequestByIdJSON)
            }
            const response = await fetch("http://localhost:5000/", sendRequest);
            if (response.status === 201) {
                const apiResponse = await response.json();
                alert(apiResponse.message);
            } else if (response.status === 400) { 
                const apiResponse = await response.json();
                alert(apiResponse.message);
                window.location.href = "secretagentpage.html";
            } else {
                alert("something went wrong?");
            }
        }

        let coll = document.getElementsByClassName("collapsible");
        let i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                let content = this.nextElementSibling;
                if (content.style.display === "block") {
                content.style.display = "none";
                } else {
                content.style.display = "block";
                }
            });
        } 
    
</script>
</html>